# IIB Containerized Workflow Environment Configuration
# Copy this file to .env.containerized and fill in your values
# DO NOT commit .env.containerized to git (it's already in .gitignore)

# ===================================================================
# Konflux Cluster Configuration
# ===================================================================
# These settings are required for the worker to connect to your Konflux dev cluster

# Konflux cluster API URL (e.g., https://api.konflux-dev.example.com:6443)
IIB_KONFLUX_CLUSTER_URL=

# Konflux cluster service account token
# To create a token:
# 1. Create a service account: kubectl create serviceaccount iib-worker -n <namespace>
# 2. Create a role with permissions to read/list pipelineruns
# 3. Create a rolebinding to bind the role to the service account
# 4. Get the token: kubectl create token iib-worker -n <namespace> --duration=720h
IIB_KONFLUX_CLUSTER_TOKEN=

# Konflux cluster CA certificate path (relative to this file)
# This should point to the file mounted at /etc/iib/konflux-ca.crt
# You can get the CA cert with: kubectl config view --raw -o jsonpath='{.clusters[0].cluster.certificate-authority-data}' | base64 -d > docker/containerized/konflux-ca.crt
IIB_KONFLUX_CLUSTER_CA_CERT=/etc/iib/konflux-ca.crt

# Namespace where Konflux pipelines run
IIB_KONFLUX_NAMESPACE=

# Pipeline timeout in seconds (default: 1800 = 30 minutes)
IIB_KONFLUX_PIPELINE_TIMEOUT=1800

# ===================================================================
# GitLab Configuration
# ===================================================================
# Required for pushing commits and creating merge requests

# GitLab tokens for different repositories
# Format: {"repo_url": {"token_name": "ENV_VAR_NAME", "token": "actual_token"}}
# Example:
# IIB_INDEX_CONFIGS_GITLAB_TOKENS_MAP='{"https://gitlab.example.com/catalogs/v4.19": {"token_name": "GITLAB_TOKEN_V419", "token": "glpat-xxxxxxxxxxxxx"}}'
IIB_INDEX_CONFIGS_GITLAB_TOKENS_MAP=

# ===================================================================
# Registry Configuration
# ===================================================================
# Configuration for the IIB output registry

# Registry where built images will be pushed
IIB_REGISTRY=registry:8443

# Template for pushing built images
# Available placeholders: {registry}, {request_id}
IIB_IMAGE_PUSH_TEMPLATE={registry}/iib-build:{request_id}

# ===================================================================
# Index DB Artifact Configuration
# ===================================================================
# Configuration for index.db artifact storage

# Registry for index.db artifacts (usually Quay.io)
IIB_INDEX_DB_ARTIFACT_REGISTRY=

# Registry for index.db ImageStream cache
IIB_INDEX_DB_IMAGESTREAM_REGISTRY=

# Template for index.db artifact storage
IIB_INDEX_DB_ARTIFACT_TEMPLATE={registry}/index-db:{tag}

# ===================================================================
# Optional Configuration
# ===================================================================

# AWS S3 bucket for storing artifacts (optional)
# IIB_AWS_S3_BUCKET_NAME=

# Greenwave URL for gating (optional)
# IIB_GREENWAVE_URL=

# Log level (DEBUG, INFO, WARNING, ERROR)
IIB_LOG_LEVEL=DEBUG

# Request logs directory (inside container)
IIB_REQUEST_LOGS_DIR=/var/log/iib/requests

# Skopeo timeout
IIB_SKOPEO_TIMEOUT=300s

# Total retry attempts for operations
IIB_TOTAL_ATTEMPTS=5

# Retry configuration
IIB_RETRY_DELAY=10
IIB_RETRY_JITTER=10
IIB_RETRY_MULTIPLIER=5
